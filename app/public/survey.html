<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">

    <!-- Bootstrap -->
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.1.3/css/bootstrap.min.css" integrity="sha384-MCw98/SFnGE8fJT3GXwEOngsV7Zt27NXFoaoApmYm81iuXoPkFOJwJ8ERdknLPMO"
        crossorigin="anonymous">
    <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.1.3/js/bootstrap.min.js" integrity="sha384-ChfqqxuZUCnJSK3+MXmPNIyE6ZbWh2IMqE241rYiqJxyMiZ6OW/JmZQ5stwEULTy"
        crossorigin="anonymous"></script>

    <!-- jQuery -->
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
    <!-- Stylesheet -->
    <link rel="stylesheet" type="text/css" href="/assets/css/style.css">

    <title>Code Buddy Finder!</title>

</head>

<body>
        <!-- The Modal -->
        <div id="myModal" class="modal">
            <div class="modal-content">
                <div class="modal-header">
                    <h2>Your Code Buddy:</h2>
                    <span class="close">&times;</span>
                </div>
                <div class="modal-body">
                    <p><span id="user"></span>, the person that will best complement your strengths while coding is:</p>
                    <p><span id="code-buddy-result"></span><br><span id="user-face"></span></p><br>
                    <p>So make sure you're getting to know them!</p>
                </div>
                <div class="modal-footer">
                    <h3> </h3>
                </div>
            </div>
        </div>
        <!-- END Modal -->
        <div class="row">
            <div class="col-12 m0" id="header">
                <h1> CODE - BUDDY - QUIZ </h1>
                <h5> Use the sliders to answer the questions below, and we'll help find your coding counterpart!</h5>
            </div>
        </div>
        <div class="row">
            <div class="col-2 m0">
                <div class="side" id="left-area">
                    <br>

                    <!-- <h5>Slide here if:</h5> -->
                    <h2 class="sidetext">FALSE</h2>

                    <br>
                </div>
            </div>
            <div class="col-8 m0">

                <form id="survey-form">
                    <div class="form-group">
                        <label for="nameInput">Your Name:</label>
                        <input type="text" name="name" class="form-control" id="survey-name" placeholder="Tell us what to call you..."><br>
                    </div>
                    <div class="form-group">
                        <label for="formControlRange">I enjoy designing UI/UX components:</label><br>
                        <input id="formControlRange1" type="range" class="form-control-range" defaultValue="5" min="0" max="10" name="Q1" step="1"><br>
                    </div>
                    <div class="form-group">
                        <label for="formControlRange">Finding elusive bugs is a strength:</label><br>
                        <input id="formControlRange2" type="range" class="form-control-range" defaultValue="5" min="0" max="10" name="Q2" step="1"><br>
                    </div>
                    <div class="form-group">
                        <label for="formControlRange">Project management is my forte:</label><br>
                        <input id="formControlRange3" type="range" class="form-control-range" defaultValue="5" min="0" max="10" name="Q3" step="1"><br>
                    </div>
                    <div class="form-group">
                        <label for="formControlRange">SQL Queries are second nature for me:</label><br>
                        <input id="formControlRange4" type="range" class="form-control-range" defaultValue="5" min="0" max="10" name="Q4" step="1"><br>
                    </div>
                    <div class="form-group">
                        <label for="formControlRange">You'd say I prefer working from the terminal:</label><br>
                        <input id="formControlRange5" type="range" class="form-control-range" defaultValue="5" min="0" max="10" name="Q5" step="1"><br>
                    </div>
                    <div class="form-group">
                        <label for="formControlRange">Creativity is my main strength:</label><br>
                        <input id="formControlRange6" type="range" class="form-control-range" defaultValue="5" min="0" max="10" name="Q6" step="1"><br>
                    </div>
                    <div class="form-group">
                        <label for="formControlRange">I prefer working on the backend:</label><br>
                        <input id="formControlRange7" type="range" class="form-control-range" defaultValue="5" min="0" max="10" name="Q7" step="1"><br>
                    </div>
                    <div class="form-group">
                        <label for="formControlRange">Can't stump me, as I can find the answer online!:</label><br>
                        <input id="formControlRange8" type="range" class="form-control-range" defaultValue="5" min="0" max="10" name="Q8" step="1"><br>
                    </div>
                    <div class="form-group">
                        <label for="formControlRange">"I know an NPM that will make this easier...":</label><br>
                        <input id="formControlRange9" type="range" class="form-control-range" defaultValue="5" min="0" max="10" name="Q9" step="1"><br>
                    </div>
                    <div class="form-group">
                        <label for="formControlRange">I think analytically:</label><br>
                        <input id="formControlRange10" type="range" class="form-control-range" defaultValue="5" min="0" max="10" name="Q10" step="1"><br>
                    </div>
                    <button id="myBtn" type="button" name="survey-submit" form="survey-form" formaction="/api/friends/" formmethod="POST">Find
                        a Code Buddy!</button>
                </form>
            </div>
            <div class="col-2 m0">
                <div class="side" id="right-area">
                    <div class="sidetext">
                        <br>

                        <!-- <h5>Slide here if:</h5> -->
                        <h2>TRUE!</h2>

                        <br>
                    </div>
                </div>
            </div>
        </div>
    




    <script>

        // MODAL Stuff: //
        var modal = document.getElementById('myModal');
        var btn = document.getElementById("myBtn");
        var span = document.getElementsByClassName("close")[0];
        btn.onclick = function () {
            modal.style.display = "block";
        };
        span.onclick = function () {
            modal.style.display = "none";
        };
        window.onclick = function (event) {
            if (event.target == modal) {
                modal.style.display = "none";
            }
        };

        // GLOBAL VARIABLES: //
        var friendsData = {};
        var friendsArray = [];
        var currentUser = {
            "name": "",
            "photo": "",
            "scores": [
                "",
                "",
                "",
                "",
                "",
                "",
                "",
                "",
                "",
                ""
            ]
        };
        var differenceArray = [];
        var compatibiilityTotaled = "0";
        var compatibilityScoresArray = [];
        var differenceArrayHolder = {};

        // CREATE FUNCTIONS: //
        var getData = function () {
            $.ajax({ url: "/api/friends", method: "GET" })
                .then(function (friendsData) {
                    // console.log(JSON.stringify(friendsData, null, 2));
                    // console.log("--------------");
                    friendsData = JSON.stringify(friendsData, null, 2);
                    friendsData = JSON.parse(friendsData);
                    // console.log("Do we have what we need? " + friendsData);
                    friendsArray = friendsData.friendsList;
                    // friendsArray = JSON.parse(friendsArray);
                    // console.log("Check formatting: " + JSON.stringify(friendsArray, null, 2));
                });
        };

        var displayResults = function () {
            document.getElementById('user').innerHTML = `${currentUser.name}`;
            document.getElementById('code-buddy-result').innerHTML = `${bestMatchPerson}`;
            document.getElementById('user-face').innerHTML = `<img src=${bestMatchPhoto}>`;
        };

        var populateCurrentUser = function () {
            currentUser = {
                "name": $("#survey-name").val(),
                "photo": "",
                "scores": [
                    +$("#formControlRange1").val(),
                    +$("#formControlRange2").val(),
                    +$("#formControlRange3").val(),
                    +$("#formControlRange4").val(),
                    +$("#formControlRange5").val(),
                    +$("#formControlRange6").val(),
                    +$("#formControlRange7").val(),
                    +$("#formControlRange8").val(),
                    +$("#formControlRange9").val(),
                    +$("#formControlRange10").val()
                ]
            };
            currentUser = JSON.stringify(currentUser, null, 2);
        };

        var compareAPair = function (arrayOne, arrayTwo, x) {
            //Get the difference between each value in the arrays when compared
            for (var i = 0; i < arrayOne.length; i++) {
                differenceArray.push(Math.abs(arrayOne[i] - arrayTwo[i]));
            }
            // console.log("Diff between " + arrayOne + " and " + arrayTwo + " is " + differenceArray);
            // console.log(differenceArray);
            // console.log(differenceArray.reduce((a, b) => a + b, 0));
            compatibilityTotaled = differenceArray.reduce((a, b) => a + b, 0);
            // console.log(x + ": " + compatibilityTotaled);
            differenceArrayHolder = { id: x, array: differenceArray };
            // console.log(differenceArrayHolder);
            differenceArray = [];
        };

        var processComparisons = function () {
            for (var j = 0; j < friendsArray.length; j++) {
                compareAPair(currentUser.scores, friendsArray[j].scores, j);
                compatibilityScoresArray.push(compatibilityTotaled);
            };
            // console.log("Comp scores array: " + compatibilityScoresArray);
            var mostCompatible = compatibilityScoresArray.reduce(function (a, b) {
                return Math.min(a, b);
            });
            for (var i = 0; i < compatibilityScoresArray.length; i++) {
                if (compatibilityScoresArray[i] == mostCompatible) {
                    bestMatchPerson = friendsArray[i].name;
                    bestMatchPhoto = friendsArray[i].photo;
                    displayResults();
                };
            };
        };

        // RUN SCRIPTS AND CODE ACTIVATIONS:

        getData();  //happens automatically so that the data is ready to be used on page load.

        //On press does the populate function. So forms are filled.   
        $("#myBtn").on("mousedown", function () {
            populateCurrentUser();
            // console.log("Check if user info is updating: " + currentUser);
            currentUser = JSON.parse(currentUser);
            // console.log(currentUser);

        });

        //On up does the comparison.
        $("#myBtn").on("mouseup", function () {
            processComparisons();
            console.log("Comparison complete!");
        });


    </script>
</body>

</html>